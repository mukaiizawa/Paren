Paren言語仕様書

この資料はParenの仕様を定義する。

# 基本概念
ParenはCommon Lispと様々なオブジェクト指向言語から影響を受けた言語である。
Common Lispをよりオブジェクト指向に扱えるように工夫がされてある。
Parenはatom又はlistによって記述され、listはatom又はlistによって記述される。
## 型
Parenの任意の値は少なくとも一つ以上の型を持つ。
その値がどの型を持つかにより値の振舞いが決定される。
任意の型は別の型に互換性を持たせることができる。
互換性を持たせることを型を継承するという。
Parenには次の型が存在する。
- composition
  - collection
    - list(collection)
    - hash(collection)
- atom
  - t(atom)
  - symbol(atom)
  - keyword(atom)
  - function(atom)
  - number(atom)
    - int(number)
    - float(number)
  - char(atom)
  - string(atom)
- nil(composition atom)
型には大きく二つcompositionとatomが存在する。
compositionはそれ単体で意味を持つatom型以外の型を、
組み合わせた合成型をいう。
括弧はその型が継承している型を示す。
型を継承する場合は、継承先の継承している型も継承される。
primitiveな型はすべて英小文字となる。
ユーザが定義する型も英小文字とするのが望ましい。
## S式
Parenはatomまたはlistにより記述される。
この記述をS式と呼ぶ。
S式は評価されるとS式か値を返す。
このS式は言語の構文木そのものである。
ParenのS式には次の種類がある。
- atom
- list
  - 関数
  - スペシャルフォーム
  - マクロ
### 関数
S式の一つは関数である。
第一引数の型により、その振舞いが変わる。
たとえば、`+`という関数があるとき、
第一引数が数字か文字列かでその振舞いが異なる。
### スペシャルフォーム
スペシャルフォームはParenの評価方式に従わない、
特殊なS式である。
スペシャルフォームには次の種類が存在する。
- quote
- goto
- tagbody
- ...
### マクロ
マクロはコンパイルされるときに、
Parenのすべての機能を用いて行える前処理のことをいう。
Parenの仕様はこの強力な機能を用いるための御膳立てに過ぎない。
マクロによりParenは進化する。
### リードマクロ
リードマクロは読み込み時に行われる一連の前処理である。
リードマクロが評価されるとS式またはatomまたはリードマクロを返す。
`'`(シングルクォート)などのシンタックスシュガーはリードマクロにより定義される。

# メタ言語
Parenの文法を以下のEBNF表記で定義する。
    x? -- xは省略可能。
    x | y -- x又はy。
    x+ -- xの一回以上の繰り返し。
    x* -- xの零回以上の繰り返し。
    () -- グループ化。
    'x' -- 固定字句。文字の並びxを示す。xは複数の場合もある。
    [...] -- 文字グループ。[]内で指定された文字の何れか。x-yと表記された場合は
             Unicodeコードポイントでxとyの間の何れか。
             先頭に~を指定した場合は[]内で指定された文字以外の何れかを示す。
    = -- 定義。左辺で示される構文要素は右辺で定義される。

# 字句規則
## 要素の区切り
Parenは空白又はコメントにより区切られる。
これらは要素の区切りとして使用される以外は無視される。
### コメント(comment)
    comment = (';'.*$ | '#|'.*'|#')
commentはセミコロンから行末まで、
または、#|で始まり|#で終わる任意の文字列で表現される。
### 空白(space)
    space = [\t\n ]
spaceはタブ文字、改行文字、半角スペースである。
## 定数
### 数値(number)
    number = integer | float
numberとして示される数値は正の数のみである。負数は構文規則側で定義する。
### 整数(int)
    integer = radix? [0-9a-z]+
    radix = (digit+ 'x')
    digit = [0-9]
整数では数+'x'を前置する事で基数を指定出来る。
基数が指定されていない場合は10が指定されたものと見做す。
基数は36まで設定可能。
0を指定すると16が指定されたものと見做す。
### 浮動小数点数(float)
    float = digit+ '.' digit+ ('e' '-'? digit+)?
指数


## atom
atomは表記自体
### atom
atomはParenでそれ以上分解できない最小単位を表す型である。
### cons
ある値へのポインタを二つ(以下、右/左側と区別する)持つデータ構造をconsと呼ぶ。
consの左側にはParenの提供するどの型の値でも保持できる。
Common Lispと異なりconsの右側のポインタに保持できる型は、
cons又はnil(後述)のみとなる。
### list
consの指すポインタを辿った全体をlistと呼ぶ。
またlistのことを式とも呼ぶ。
### nil
nilには次の意味がある。
- 要素がないlist(空のlist)を表す。
- nilはParenの真偽値の偽として振舞う唯一の値である。
- nullポインタを表す。

# 評価

# 文字コード
ソースファイルはすべてUTF-8で記述しなければならない。
